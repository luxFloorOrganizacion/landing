---
import '../styles/testimonials.scss'; 
---

<section class="testimonials-section">
  <h2 class="testimonials-title">Testimonials</h2>
  <p class="testimonials-subtitle">Floors Designed to Withstand Daily Use and Stay Impeccable for Years.</p>

  <div class="testimonials-panel">
    <div class="testimonials-tabs" role="tablist" aria-label="Clients">
      </div>

    <div class="testimonials-grid">
      <article class="card is-visible" id="current-testimonial-card">
        <div class="card-stars" aria-label="5 out of 5 stars">
          <svg width="20" height="20" fill="#C35C3B"><path d="M9.604 1.912a.42.42 0 01.792 0l1.925 3.9a2.33 2.33 0 001.545 1.246l4.305.63a.42.42 0 01.233.713l-3.113 3.032a2.33 2.33 0 00-.449 1.565l.735 4.283a.42.42 0 01-.61.443l-3.848-2.023a2.33 2.33 0 00-2.444 0l-3.848 2.023a.42.42 0 01-.61-.443l.734-4.283a2.33 2.33 0 00-.448-1.565L1.8 8.162a.42.42 0 01.244-.713l4.304-.63A2.33 2.33 0 007.68 5.812l1.925-3.9z"/></svg>
          <svg width="20" height="20" fill="#C35C3B"><path d="M9.604 1.912a.42.42 0 01.792 0l1.925 3.9a2.33 2.33 0 001.545 1.246l4.305.63a.42.42 0 01.233.713l-3.113 3.032a2.33 2.33 0 00-.449 1.565l.735 4.283a.42.42 0 01-.61.443l-3.848-2.023a2.33 2.33 0 00-2.444 0l-3.848 2.023a.42.42 0 01-.61-.443l.734-4.283a2.33 2.33 0 00-.448-1.565L1.8 8.162a.42.42 0 01.244-.713l4.304-.63A2.33 2.33 0 007.68 5.812l1.925-3.9z"/></svg>
          <svg width="20" height="20" fill="#C35C3B"><path d="M9.604 1.912a.42.42 0 01.792 0l1.925 3.9a2.33 2.33 0 001.545 1.246l4.305.63a.42.42 0 01.233.713l-3.113 3.032a2.33 2.33 0 00-.449 1.565l.735 4.283a.42.42 0 01-.61.443l-3.848-2.023a2.33 2.33 0 00-2.444 0l-3.848 2.023a.42.42 0 01-.61-.443l.734-4.283a2.33 2.33 0 00-.448-1.565L1.8 8.162a.42.42 0 01.244-.713l4.304-.63A2.33 2.33 0 007.68 5.812l1.925-3.9z"/></svg>
          <svg width="20" height="20" fill="#C35C3B"><path d="M9.604 1.912a.42.42 0 01.792 0l1.925 3.9a2.33 2.33 0 001.545 1.246l4.305.63a.42.42 0 01.233.713l-3.113 3.032a2.33 2.33 0 00-.449 1.565l.735 4.283a.42.42 0 01-.61.443l-3.848-2.023a2.33 2.33 0 00-2.444 0l-3.848 2.023a.42.42 0 01-.61-.443l.734-4.283a2.33 2.33 0 00-.448-1.565L1.8 8.162a.42.42 0 01.244-.713l4.304-.63A2.33 2.33 0 007.68 5.812l1.925-3.9z"/></svg>
          <svg width="20" height="20" fill="#C35C3B"><path d="M9.604 1.912a.42.42 0 01.792 0l1.925 3.9a2.33 2.33 0 001.545 1.246l4.305.63a.42.42 0 01.233.713l-3.113 3.032a2.33 2.33 0 00-.449 1.565l.735 4.283a.42.42 0 01-.61.443l-3.848-2.023a2.33 2.33 0 00-2.444 0l-3.848 2.023a.42.42 0 01-.61-.443l.734-4.283a2.33 2.33 0 00-.448-1.565L1.8 8.162a.42.42 0 01.244-.713l4.304-.63A2.33 2.33 0 007.68 5.812l1.925-3.9z"/></svg>
        </div>
        <p class="card-quote" id="card-quote"></p>
        <div class="card-author">
          <img class="avatar" id="author-avatar" src="" alt="" />
          <div>
            <p class="author-name" id="author-name"></p>
            <p class="author-role" id="author-role"></p>
          </div>
        </div>
      </article>

      <aside class="stats">
        <div class="stat">
          <div class="stat-value">
            <span>87%</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M16 7H22V13" stroke="#C35C3B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 7L13.5 15.5L8.5 10.5L2 17" stroke="#C35C3B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <p class="stat-label">Increase in customer satisfaction</p>
        </div>
        <div class="stat">
          <div class="stat-value">
            <span>38%</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M16 7H22V13" stroke="#142748" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 7L13.5 15.5L8.5 10.5L2 17" stroke="#142748" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <p class="stat-label">Increase in operational efficiency</p>
        </div>
      </aside>
    </div>

    <div class="testimonials-nav">
      <button class="testimonials-nav__btn" aria-label="Previous testimonial">←</button>
      <button class="testimonials-nav__btn" aria-label="Next testimonial">→</button>
    </div>
  </div>
</section>

<script>
  // --------------------------------------------
  // Datos inventados de los testimonios
  // --------------------------------------------
  const testimonialsData = [
    {
      name: "John Doe",
      role: "Managing Director, Spherule",
      company: "Spherule",
      quote: "Trusted Flooring transformed our home. The installation was flawless, and the floors look stunning.",
      avatar: "image-john-doe0.png",
      tab: "Capsule"
    },
    {
      name: "Jane Smith",
      role: "CEO, Stellar Designs",
      company: "Stellar Designs",
      quote: "Our floors are now the centerpiece of our office. Excellent quality and professional installation.",
      avatar: "image-jane-smith.png",
      tab: "Spherule"
    },
    {
      name: "Michael Brown",
      role: "Product Manager, Galileo",
      company: "Galileo",
      quote: "Floors were installed quickly and look amazing. Highly recommend their services!",
      avatar: "image-michael-brown.png",
      tab: "Galileo"
    },
    {
      name: "Lisa White",
      role: "Operations Lead, Segment",
      company: "Segment",
      quote: "Professional and reliable service. The new flooring elevates the whole office vibe.",
      avatar: "image-lisa-white.png",
      tab: "Segment"
    }
  ];

  // Elementos del DOM necesarios
  const tabsContainer = document.querySelector('.testimonials-tabs');
  const cardElement = document.getElementById('current-testimonial-card'); 
  const quoteElement = document.getElementById('card-quote');
  const avatarElement = document.querySelector<HTMLImageElement>('#author-avatar');
  const nameElement = document.getElementById('author-name');
  const roleElement = document.getElementById('author-role');
  const prevBtn = document.querySelector('.testimonials-nav__btn[aria-label="Previous testimonial"]');
  const nextBtn = document.querySelector('.testimonials-nav__btn[aria-label="Next testimonial"]');
  
  let currentIndex = 0;

  // -------------------------------
  // Función principal de actualización de datos
  // -------------------------------
  function updateTestimonialCard(index:any) {
    const testimonial = testimonialsData[index];
    
    // 1. Iniciar animación de salida
    if (cardElement) {
        cardElement.classList.remove('is-visible');
    }

    // Usamos setTimeout para permitir que la animación de salida se ejecute antes de cambiar el contenido
    setTimeout(() => {
        // 2. Sustituir los datos
        if (quoteElement) quoteElement.textContent = testimonial.quote;
        if (avatarElement) {
          avatarElement.src = testimonial.avatar;
          avatarElement.alt = testimonial.name;
        }
        if (nameElement) nameElement.textContent = testimonial.name;
        if (roleElement) roleElement.textContent = testimonial.role;
        
        // 3. Iniciar animación de entrada
        if (cardElement) {
          cardElement.classList.add('is-visible');
        }
    }, 400); // 400ms debe coincidir con la duración de la transición en SCSS
    
    updateTabs();
  }


  function updateTabs() {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach((tab, i) => {
      tab.classList.toggle('tab--active', i === currentIndex);
      tab.setAttribute('aria-selected', i === currentIndex ? 'true' : 'false');
    });
  }

  // -------------------------------
  // Generar Tabs y Listeners
  // -------------------------------
  if (tabsContainer) {
    testimonialsData.forEach((testimonial, index) => {
      const tabBtn = document.createElement('button');
      tabBtn.className = 'tab';
      if (index === 0) tabBtn.classList.add('tab--active');
      tabBtn.setAttribute('role', 'tab');
      tabBtn.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
      tabBtn.innerText = testimonial.tab;
      
      tabBtn.addEventListener('click', () => {
        currentIndex = index;
        updateTestimonialCard(currentIndex); 
      });
      tabsContainer.appendChild(tabBtn);
    });
  }

  // -------------------------------
  // Escuchadores de eventos de navegación
  // -------------------------------
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + testimonialsData.length) % testimonialsData.length;
      updateTestimonialCard(currentIndex); 
    });
  }

  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % testimonialsData.length;
      updateTestimonialCard(currentIndex); 
    });
  }

  // -------------------------------
  // Inicialización: Muestra el primer testimonio al cargar
  // -------------------------------
  updateTestimonialCard(currentIndex); 
</script>
